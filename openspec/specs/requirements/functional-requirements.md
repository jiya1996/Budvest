# Functional Requirements

**版本**: v1.0  
**更新日期**: 2026-01-20  
**优先级方法**: MoSCoW (Must / Should / Could / Won't)

---

## Must Have - MVP 核心闭环

### FR-001: 零门槛启动

**优先级**: P0 - Must Have  
**价值**: 降低试用门槛，快速建立信任

#### Requirement 描述

用户可以无需注册/登录即可开始使用产品，通过简单的初心设定(15秒内完成)建立心理锚点。

#### Acceptance Criteria

- **AC-001.1**: 首次打开 APP，直接进入初心设定页，无需登录
- **AC-001.2**: 展示 2-3 个预设投资目标选项（长期持有/把握机会/其他），用户至少选择 1 项
- **AC-001.3**: 选择完成后，系统生成唯一 Guest UUID 并存储到 localStorage
- **AC-001.4**: 自动跳转到首页，用户可立即开始对话
- **AC-001.5**: Guest 用户数据写入 `user_profiles` 表，`guest` 字段为 true

#### Out of Scope (MVP)

- OAuth 社交登录（Google/Apple）
- 邮箱验证码登录
- 微信小程序授权登录

---

### FR-002: AI 情绪教练对话

**优先级**: P0 - Must Have  
**价值**: 产品核心价值的最小体现，社交媒体展示重点 A

#### Requirement 描述

用户可以与 1 位核心 AI 导师（心理教练）进行多轮对话，AI 能识别用户情绪并提供温暖、共情的回应。

#### Acceptance Criteria

- **AC-002.1**: 首页有明显的"开始对话"入口（FAB 或显著按钮）
- **AC-002.2**: 支持文字输入，实时流式响应（打字机效果）
- **AC-002.3**: AI 在每轮对话中识别用户情绪（anxious/panic/greedy/angry/calm）
- **AC-002.4**: AI 回复必须体现共情，避免生硬的投资建议
- **AC-002.5**: 对话历史保存到 Supabase `chat_messages` 表
- **AC-002.6**: 用户可以查看最近 15 天的对话记录
- **AC-002.7**: 单次对话轮数无限制，但建议 5-10 轮为佳

#### Scenario 示例

```
用户: "我的茅台今天跌了 5%，好焦虑..."
AI: "我隔着屏幕都感受到了你的不安（emotion: anxious）。
     市场波动时的焦虑是很正常的。让我们先深呼吸，
     然后一起理性看看发生了什么。你当初买入茅台的理由是什么？"
```

#### Out of Scope (MVP)

- 语音输入/输出
- 多个导师切换（MVP 仅 1 位）
- 图片/文件上传

---

### FR-003: 投资心理复盘

**优先级**: P0 - Must Have  
**价值**: 完成从"情绪识别"到"反思成长"的闭环，社交媒体展示重点 C

#### Requirement 描述

对话结束后，系统引导用户完成 3 步结构化复盘，并由 AI 生成复盘总结。

#### Acceptance Criteria

- **AC-003.1**: 对话页面头部有"✅ 记录"按钮，随时可触发复盘
- **AC-003.2**: 对话结束（30 分钟无交互）时，自动弹出复盘引导
- **AC-003.3**: Step  1: 情绪变化滑动条，用户选择对话前后的情绪值（1-5 分）
- **AC-003.4**: Step 2: 决策选择（锁仓🔒 / 加仓📈 / 减仓📉 / 清仓🚫）
- **AC-003.5**: Step 3: 可选文字备注（最多 200 字）
- **AC-003.6**: 提交后，AI 生成复盘总结（对比识别的情绪 vs 用户选择）
- **AC-003.7**: 复盘记录保存到 Supabase `review_entries` 表
- **AC-003.8**: 用户可以查看历史复盘记录，按时间倒序展示

#### Scenario 示例

```
复盘卡片:
┌─────────────────────────────┐
│ Step 1: 心情变化             │
│  😰   😟   😐   🙂   😌    │
│   1    2    3    4    5     │
│   ●─────────●               │
│ (对话前: 2 → 对话后: 4)      │
├─────────────────────────────┤
│ Step 2: 你的决策             │
│  ○ 🔒 锁仓                  │
│  ● 📈 加仓                  │
│  ○ 📉 减仓                  │
│  ○ 🚫 清仓                  │
├─────────────────────────────┤
│ Step 3: 备注（可选）         │
│  [决定长期持有...]          │
└─────────────────────────────┘

AI 总结: "你从焦虑(2分)到相对平静(4分)，
这是巨大的进步。你选择了加仓，说明你对
长期价值有信心。继续保持这份理性！"
```

---

### FR-004: 每日情绪打卡

**优先级**: P0 - Must Have  
**价值**: 养成习惯的关键，建立长期粘性

#### Requirement 描述

用户每天可以记录当天的整体情绪状态，系统展示 7 日情绪趋势。

#### Acceptance Criteria

- **AC-004.1**: 首页顶部显示情绪打卡入口（明显但不侵入）
- **AC-004.2**: 4 个 Emoji 单选（😰焦虑 / 🤑贪婪 / 😡愤怒 / 🙂平静）
- **AC-004.3**: 当天可重复打卡（覆盖），次日凌晨 0 点后锁定无法修改
- **AC-004.4**: 打卡后展示 7 日情绪趋势折线图
- **AC-004.5**: 趋势图使用颜色渐变（红色 → 绿色）表示情绪变化
- **AC-004.6**: 打卡数据保存到 Supabase `emotion_logs` 表

#### Out of Scope (MVP)

- 多选情绪
- 情绪强度滑块（1-10 分）
- 长期统计（月度/年度报告）

---

## Should Have - 增强体验（Week 3-4）

### FR-005: 多智能体协作分析

**优先级**: P1 - Should Have  
**价值**: 技术亮点，提供专业分析能力

#### Requirement 描述

当用户提出复杂问题时，协调员智能体自动判断并调度专业智能体串行协作。

#### Acceptance Criteria

- **AC-005.1**: 协调员根据用户输入判断问题复杂度（简单 vs 复杂）
- **AC-005.2**: 简单问题：单个导师直接回答
- **AC-005.3**: 复杂问题：串行调度 研究员 → 分析师 → 风控员 → 导师
- **AC-005.4**: 用户能在对话中看到各智能体的贡献（标注）
- **AC-005.5**: 研究员调用市场 API（Eastmoney/Sina）获取实时数据
- **AC-005.6**: 最终由导师汇总并给出心理建议

#### Scenario 示例

```
用户: "贵州茅台最近怎么样？"

协调员: [判断为复杂问题，启动多智能体协作]

研究员: "我帮你查了一下，茅台最近公布了 Q4 财报，
         营收增长 8%，略低于预期..."

分析师: "从技术面看，茅台在 1650 元附近有强支撑，
         当前回调属于正常范围..."

风控员: "根据你的持仓，茅台占比 30%，风险适中。
         如果继续下跌，建议止损线设在 1580 元..."

导师: "综合来看，茅台的基本面没有根本变化。
       你当初买入的理由是看好长期价值，对吗？
       现在的波动是在考验你的信念。"
```

---

### FR-006: 心理锚点（关注资产）

**优先级**: P1 - Should Have  
**价值**: 增强个性化，建立情感连接

#### Requirement 描述

用户可以添加 1-3 个关注的股票作为"心理锚点"，首页展示实时价格。

#### Acceptance Criteria

- **AC-006.1**: 初心设定后，引导用户添加 1-3 个关注资产（可跳过）
- **AC-006.2**: 支持股票代码/名称搜索，匹配 A 股/美股/港股
- **AC-006.3**: 搜索建议展示：代码、名称、市场、实时价格
- **AC-006.4**: 最多添加 3 个，超过后禁用添加按钮
- **AC-006.5**: 首页显示关注资产卡片，包含：logo、名称、价格、涨跌幅
- **AC-006.6**: 点击资产卡片，触发带上下文的对话（预填资产信息）
- **AC-006.7**: 关注列表保存到 Supabase `watchlists` 表

---

### FR-007: 情绪筹码快捷入口

**优先级**: P1 - Should Have  
**价值**: 降低对话门槛，快速触达核心功能

#### Requirement 描述

首页展示 4 个情绪筹码，点击后 AI 自动镜像共情并开启对话。

#### Acceptance Criteria

- **AC-007.1**: 首页中部显示 4 个情绪筹码 UI
- **AC-007.2**: 筹码内容：😰我慌了 / 🤑怕踏空 / 😡气死了 / 😌想复盘
- **AC-007.3**: 点击筹码后，直接进入对话页面
- **AC-007.4**: AI 自动发送镜像共情开场白：
  - 我慌了 → "我隔着屏幕都感到了你的焦急..."
  - 怕踏空 → "那种眼睁睁看着别人赚钱的感觉，我懂..."
  - 气死了 → "这种愤怒是正常的，让我陪你..."
  - 想复盘 → "很高兴你想复盘，这是成长的开始..."

---

## Could Have - 锦上添花（Week 5-6）

### FR-008: 简化持仓管理

**优先级**: P2 - Could Have  
**价值**: 辅助功能，不影响核心价值

#### Requirement 描述

用户可以手动记录持仓信息，系统显示实时盈亏。

#### Acceptance Criteria

- **AC-008.1**: 持仓页面可手动添加持仓：股票代码 + 数量 + 成本价
- **AC-008.2**: 系统自动计算实时盈亏（当前价 vs 成本价）
- **AC-008.3**: 支持编辑和删除持仓
- **AC-008.4**: 持仓数据保存到 Supabase `portfolio_items` 表

#### Out of Scope (MVP)

- 券商账户同步
- 自动交易记录导入
- 历史收益率曲线

---

### FR-009: 情绪熔断机制

**优先级**: P2 - Could Have  
**价值**: 高级保护机制，但单次对话已有情绪识别

#### Requirement 描述

当检测到用户连续 5 轮极端负面情绪时，触发 30 秒强制冷静期。

#### Acceptance Criteria

- **AC-009.1**: 后端检测连续 5 轮对话中情绪为 panic 或 angry
- **AC-009.2**: 触发熔断时，隐藏输入框
- **AC-009.3**: 展示深呼吸动画 + 30 秒倒计时
- **AC-009.4**: 倒计时结束后，展示"写下你冷静后的想法"输入框（可选）
- **AC-009.5**: 熔断记录保存到 `emotion_records` 表（需新建）

---

---

## User Engagement & Retention Features

### FR-010: 每日市场情绪简报

**优先级**: P0 - Must Have (Week 1-2)  
**价值**: 建立每日打开习惯，提供正向驱动的打开动机

#### Requirement 描述

每天早上 9:00 推送市场情绪简报，30 秒阅读完，包含 A 股/美股情绪指数、关键事件和今日心理建议。

#### Acceptance Criteria

- **AC-010.1**: 每天早上 9:00 自动生成并推送简报
- **AC-010.2**: 简报包含 3 个模块：
  - 📊 A 股/美股昨日情绪指数（恐慌/中性/乐观）
  - 🔥 3 条关键市场事件（如"茅台跌 3%，机构调研增加"）
  - 💡 今日心理建议（如"今天适合冷静复盘，不适合追涨"）
- **AC-010.3**: 简报底部有快速打卡入口："记录你今天的情绪"
- **AC-010.4**: 用户可查看最近 7 天的历史简报
- **AC-010.5**: 简报数据保存到 `daily_briefs` 表（需新建）

#### Benchmark

类似 36 氪早报、虎嗅晨报，但专注情绪 + 心理

---

### FR-011: 连续打卡与成就系统

**优先级**: P0 - Must Have (Week 1-2)  
**价值**: Gamification 提升 30-day retention **34%**（研究数据支持）

#### Requirement 描述

用户连续打卡天数显著展示，解锁徽章和里程碑奖励，提供即时正向反馈。

#### Acceptance Criteria

- **AC-011.1**: 首页顶部显著展示连续打卡天数（如"🔥 连续 15 天"）
- **AC-011.2**: 徽章系统包含 4 个核心徽章：
  - "稳定之心" - 连续 7 天情绪平静
  - "冷静投资者" - 30 天无冲动交易记录
  - "深度反思者" - 完成 10 次深度复盘
  - "市场老兵" - 经历 1 次暴跌（单日跌 > 5%）且情绪稳定
- **AC-011.3**: 里程碑奖励：
  - 第 7 天：解锁"7 日情绪报告"
  - 第 30 天：解锁"心智成熟度评分"
  - 第 90 天：解锁"个性化成长洞察"
- **AC-011.4**: 打卡后立即展示动画："✨ 恭喜！连续 15 天，击败了 80% 用户"
- **AC-011.5**: 徽章数据保存到 `user_achievements` 表（需新建）
- **AC-011.6**: 用户可在个人主页查看所有徽章（已解锁 + 未解锁）

---

### FR-012: Smart Push Notification System

**优先级**: P0 - Must Have (Week 1-2)  
**价值**: Habit formation 关键机制，提升 DAU/MAU Stickiness

#### Requirement 描述

智能推送通知系统，包含每日定时、市场异动、行为触发和情绪风险 4 种推送类型。

#### Acceptance Criteria

- **AC-012.1**: 每日定时推送（用户可自定义时间）：
  - 🌅 早间简报（默认 9:00）："今日市场情绪 + 心理建议"
  - 🌙 晚间复盘（默认 21:00）："今天你还没有记录情绪哦"
- **AC-012.2**: 市场异动推送（智能触发）：
  - 📉 A 股跌 > 3%："市场波动较大，要不要和 AI 聊聊？"
  - 📈 持仓股票涨/跌 > 5%："贵州茅台今天涨了 6%，保持冷静~"
- **AC-012.3**: 行为触发推送：
  - 🔥 连续打卡即将中断："已连续 14 天，明天别忘了哦！"
  - 🎉 里程碑达成："恭喜！你的心智成熟度突破 70 分！"
- **AC-012.4**: 情绪风险预警：
  - ⚠️ 检测到连续 3 天负面情绪："需要启动情绪熔断机制吗？"
- **AC-012.5**: 智能学习：AI 学习用户最佳打开时间，避免打扰时段
- **AC-012.6**: 用户可完全控制推送频率和类型（设置页面）
- **AC-012.7**: 推送记录保存到 `push_notifications` 表（需新建）

#### Integration

使用 OneSignal（免费 10K MAU），详见 `architecture/push-notification-system.md`

---

### FR-013: 情绪雷达图与成长可视化

**优先级**: P1 - Should Have (Week 3-4)  
**价值**: 长期价值累积，"越用越有价值"的感觉

#### Requirement 描述

实时可视化用户情绪模式，展示情绪雷达图和对比数据。

#### Acceptance Criteria

- **AC-013.1**: 情绪雷达图展示过去 7/30/90 天的情绪分布：

  ```
       恐慌
        /\
       /  \
  贪婪 ──  ── 愤怒
       \  /
        \/
       平静
  ```

- **AC-013.2**: AI 生成洞察："你在市场下跌时容易恐慌（40%），但通过复盘后恢复平静（80%）"
- **AC-013.3**: 对比数据："你的情绪稳定度超过 65% 的用户"
- **AC-013.4**: 用户可切换时间范围（7/30/90 天）
- **AC-013.5**: 雷达图数据基于 `emotion_logs` 表聚合生成

---

### FR-014: 投资心智成熟度评分（后续扩展）

**优先级**: P1 - Should Have (Week 4-5)  
**价值**: 量化成长目标

#### Requirement 描述

量化用户心理成长，生成 0-100 分的成熟度评分。

#### Acceptance Criteria

- **AC-014.1**: 评分计算基于 4 个维度：
  - 情绪稳定度（40% 权重）
  - 决策质量（30% 权重）
  - 学习进度（20% 权重）
  - 坚持度（10% 权重）
- **AC-014.2**: 首页显示当前分数 + 击败百分比
- **AC-014.3**: 可查看各维度的详细分析
- **AC-014.4**: 每周自动更新分数

---

## Won't Have - MVP 明确不做

### ❌ FR-015: 策略锁定（信念/纪律模式）

**理由**: 功能复杂度高，需要额外的 `strategy_locks` 表和 3 小时冷却逻辑，MVP 阶段价值不明显

### ❌ FR-011: 多个导师切换

**理由**: MVP 阶段 1 个核心导师（心理教练）足够，避免用户困惑，后续根据反馈添加

### ❌ FR-012: 自然语言持仓命令

**理由**: 高级功能，手动输入已满足基本需求，避免 MVP 过于复杂

### ❌ FR-013: K 线图表和技术指标

**理由**: 避免产品定位偏移，我们聚焦心理成长而非技术分析工具

### ❌ FR-016: 匿名成长社区（暂不实施）

**理由**: MVP 阶段优先级最低（用户反馈），Post-MVP 再考虑

### ❌ FR-017: 模拟交易

**理由**: 与核心价值（情绪管理）无关，增加开发成本

---

## Traceability Matrix (需求追溯矩阵)

| Functional Requirement | 业务目标 | 用户痛点 | 产品愿景阶段 |
|----------------------|---------|---------|------------|
| FR-001 零门槛启动 | 快速获客 | 注册门槛高 | 入门 - 建立信任 |
| FR-002 AI 对话 | 核心价值交付 | 情绪无人理解 | 入门 - 情绪陪伴初体验 |
| FR-003 心理复盘 | 用户成长 | 重复犯错 | 进阶 - 建立决策框架 |
| FR-004 情绪打卡 | 习惯养成 | 缺乏自我觉察 | 成长 - 自我觉察 |
| FR-005 多智能体 | 技术差异化 | 缺乏专业分析 | 进阶 - 专业分析能力 |
| FR-006 心理锚点 | 个性化 | 缺乏情感连接 | 入门 - 心理锚点 |
| FR-007 情绪筹码 | 降低使用门槛 | 不知道怎么开始 | 入门 - 快速触达 |
| FR-008 持仓管理 | 完整性 | 数据分散 | 进阶 - 数据整合 |
| FR-009 情绪熔断 | 用户保护 | 极端情绪决策 | 进阶 - 保护机制 |
| FR-010 每日简报 | 建立打开习惯 | 缺乏打开动机 | 入门 - 每日仪式感 |
| FR-011 连续打卡 | 即时奖励 | 缺乏正向反馈 | 入门 - Gamification |
| FR-012 Smart Push | 主动触达 | 用户忘记打开 | 留存 - Habit Formation |
| FR-013 情绪雷达图 | 长期价值累积 | 看不到成长 | 成长 - 可视化进步 |
| FR-014 成熟度评分 | 量化目标 | 目标模糊 | 成长 - 自我评估 |

---

**最后更新**: 2026-01-20  
**下次评审**: Week 2 结束后根据实现情况调整
