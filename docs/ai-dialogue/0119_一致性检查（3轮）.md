# ä¸‰æ–¹å¯¹æ¯”ï¼šPRDã€æ¶æ„æ–‡æ¡£ã€å·¥ç¨‹ä»£ç å·®å¼‚åˆ†æ

**åˆ†ææ—¥æœŸ**: 2026-01-19
**å¯¹æ¯”æ–‡æ¡£**:
- **æ–‡æ¡£A**: `docs/PRD/MindVest_PRD_Complete_Mergedï¼ˆ260119ä¿®æ”¹ï¼‰.md` (PRDå®Œæ•´ç‰ˆ)
- **æ–‡æ¡£B**: `docs/ai-dialogue/0117_1515-é¡¹ç›®æ¶æ„.md` (æ¶æ„è®¾è®¡æ–‡æ¡£)
- **ä»£ç åº“**: `/Users/tal/Downloads/Budvest-antigravity-2/` (å®é™…å·¥ç¨‹ä»£ç )

---

## æ‰§è¡Œæ‘˜è¦

ğŸš¨ **ä¸¥é‡ä¸ä¸€è‡´**: **æ ¸å¿ƒAIç³»ç»Ÿå°šæœªè¿ç§»åˆ°Claude Agent SDK**

| ç»´åº¦ | PRDæ–‡æ¡£ | æ¶æ„æ–‡æ¡£ | å®é™…ä»£ç  | ä¸€è‡´æ€§ |
|------|---------|----------|----------|--------|
| **AIæœåŠ¡** | Claude Agent SDK | Claude Agent SDK | âŒ **OpenAI GPT-4o** | âŒ ä¸ä¸€è‡´ |
| **Agentæ¶æ„** | 5ä¸ªä¸“ä¸šAgent | 5ä¸ªä¸“ä¸šAgent | âŒ **æ— Agentç³»ç»Ÿ** | âŒ ä¸ä¸€è‡´ |
| **å·¥å…·ç³»ç»Ÿ** | MCP Server + 9å·¥å…· | MCP Server + 9å·¥å…· | âŒ **OpenAI Function Calling + 10å·¥å…·** | âŒ ä¸ä¸€è‡´ |
| **æ•°æ®æº** | Eastmoney + Sina + FMP | Eastmoney + Sina + FMP | âš ï¸ **ä»…Sina + FMP** | âš ï¸ éƒ¨åˆ†ç¼ºå¤± |

**æ€»ä½“è¯„ä¼°**: PRDå’Œæ¶æ„æ–‡æ¡£æè¿°çš„Claude Agent SDKç³»ç»Ÿ**å°šæœªå®ç°**ï¼Œç°æœ‰ä»£ç ä»ä½¿ç”¨OpenAIæ¶æ„ã€‚

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šAIæ¶æ„å¯¹æ¯”

### 1.1 AIæœåŠ¡æä¾›å•†

| æ¥æº | AIæœåŠ¡ | æ¨¡å‹ | çŠ¶æ€ |
|------|--------|------|------|
| **PRD** (ç¬¬2812è¡Œ) | Claude | Sonnet & Haiku | ğŸ“ å·²æ–‡æ¡£åŒ– |
| **æ¶æ„æ–‡æ¡£** (ç¬¬256-264è¡Œ) | Claude Agent SDK | Sonnet (åè°ƒ/åˆ†æ/é£æ§/å¯¼å¸ˆ), Haiku (ç ”ç©¶) | ğŸ“ å·²è®¾è®¡ |
| **ä»£ç ** (`app/api/chat/route.ts:8-10`) | **OpenAI** | **gpt-4o** | âš ï¸ **æœªè¿ç§»** |

**ä»£ç è¯æ®**:
```typescript
// app/api/chat/route.ts:8-10
const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});
```

**å·®å¼‚**: PRDå’Œæ¶æ„æ–‡æ¡£å·²å®ŒæˆClaudeè¿ç§»è§„åˆ’ï¼Œä½†**ä»£ç ä»ä½¿ç”¨OpenAI**ã€‚

---

### 1.2 Agentç³»ç»Ÿæ¶æ„

#### 1.2.1 PRDå’Œæ¶æ„æ–‡æ¡£å®šä¹‰

**PRD (ç¬¬2162-2168è¡Œ)**: 5ä¸ªä¸“ä¸šAgent + 7ä½Mentoräººæ ¼

| Agent | è§’è‰² | å·¥å…· | æ¨¡å‹ |
|-------|------|------|------|
| Coordinator | åè°ƒå‘˜ | Task, Read, Grep, AskUserQuestion | Sonnet |
| Researcher | ç ”ç©¶å‘˜ | Eastmoney API, Sina Finance API, WebSearch | Haiku |
| Analyst | åˆ†æå¸ˆ | Market Data, WebSearch, Read, Grep | Sonnet |
| Risk Manager | é£æ§å‘˜ | Market Data, Calculations, WebSearch | Sonnet |
| Mentor (7ä½) | å¿ƒç†å¯¼å¸ˆ | Read, Grep (RAG) | Sonnet |

**æ¶æ„æ–‡æ¡£ (ç¬¬256-264è¡Œ)**: ç¡®è®¤5ä¸ªAgent + æ··åˆæ¨¡å¼å·¥ä½œæµ

```
ç”¨æˆ·æ¶ˆæ¯ â†’ Coordinator (æ„å›¾åˆ†ç±»)
  â”œâ”€ ç®€å•é—®é¢˜ï¼šç›´æ¥å›ç­”
  â”œâ”€ å•ä¸€ä»»åŠ¡ï¼šè°ƒç”¨å•ä¸ªAgent
  â””â”€ å¤æ‚ä»»åŠ¡ï¼šä¸²è¡Œè°ƒåº¦ (Researcher â†’ Analyst â†’ Risk Manager â†’ Mentor)
```

#### 1.2.2 å®é™…ä»£ç å®ç°

**æ–‡ä»¶æ£€æŸ¥ç»“æœ**:
```bash
âŒ lib/claude-agents.ts - NOT FOUND (åº”åŒ…å«5ä¸ªAgentå®šä¹‰)
âŒ lib/mcp-tools.ts - NOT FOUND (åº”åŒ…å«MCP Server + 9å·¥å…·)
âŒ app/api/chat-claude/route.ts - NOT FOUND (åº”ä¸ºClaude Agentå…¥å£)
âœ… lib/tools.ts - EXISTS (688è¡Œ, OpenAI Function Calling)
âœ… app/api/chat/route.ts - EXISTS (OpenAI GPT-4oå®ç°)
```

**ç°æœ‰å®ç°** (`app/api/chat/route.ts`):
- **æ— Agentç³»ç»Ÿ**: ä½¿ç”¨å•ä¸€GPT-4oæ¨¡å‹å¤„ç†æ‰€æœ‰å¯¹è¯
- **å¯¼å¸ˆåˆ‡æ¢**: é€šè¿‡ä¸åŒçš„system promptå®ç°7ä½å¯¼å¸ˆäººæ ¼ (lib/types.ts:Guru)
- **å·¥å…·è°ƒç”¨**: OpenAI Function Calling (éMCP Server)

**ç»“è®º**: âŒ **Claude Agent SDKç³»ç»Ÿå®Œå…¨æœªå®ç°**

---

### 1.3 7ä½Mentorå¯¼å¸ˆç³»ç»Ÿ

| å¯¼å¸ˆID | PRDå®šä¹‰ | æ¶æ„æ–‡æ¡£ | ä»£ç å®ç° |
|--------|---------|----------|----------|
| buffett | âœ… ä»·å€¼æŠ•èµ„æ´¾ | âœ… ç¡®è®¤ä¿ç•™ | âœ… `lib/types.ts:Guru` |
| soros | âœ… åèº«æ€§ç†è®º | âœ… ç¡®è®¤ä¿ç•™ | âœ… `lib/types.ts:Guru` |
| munger | âœ… ç†æ€§å†³ç­–æ´¾ | âœ… ç¡®è®¤ä¿ç•™ | âœ… `lib/types.ts:Guru` |
| dalio | âœ… åŸåˆ™ç³»ç»Ÿæ´¾ | âœ… ç¡®è®¤ä¿ç•™ | âœ… `lib/types.ts:Guru` |
| lynch | âœ… æˆé•¿æŠ•èµ„æ´¾ | âœ… ç¡®è®¤ä¿ç•™ | âœ… `lib/types.ts:Guru` |
| wood | âœ… åˆ›æ–°ç§‘æŠ€æ´¾ | âœ… ç¡®è®¤ä¿ç•™ | âœ… `lib/types.ts:Guru` |
| coach | âœ… å¿ƒç†é™ªä¼´æ´¾ | âœ… ç¡®è®¤ä¿ç•™ | âœ… `lib/types.ts:Guru` |

**å®ç°æ–¹å¼å·®å¼‚**:
- **PRD/æ¶æ„**: 7ä½å¯¼å¸ˆä½œä¸ºMentor Agentçš„ä¸åŒäººæ ¼ï¼Œé€šè¿‡Agentåˆ‡æ¢
- **ä»£ç **: 7ä½å¯¼å¸ˆé€šè¿‡ä¸åŒçš„system promptå®ç°ï¼Œæ— Agentæ¦‚å¿µ

**ç»“è®º**: âš ï¸ **å¯¼å¸ˆå®šä¹‰ä¸€è‡´ï¼Œä½†å®ç°æ¶æ„ä¸åŒ** (OpenAI promptåˆ‡æ¢ vs Claude Agent)

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šå·¥å…·ç³»ç»Ÿå¯¹æ¯”

### 2.1 å·¥å…·æ¶æ„

| ç»´åº¦ | PRD | æ¶æ„æ–‡æ¡£ | ä»£ç å®ç° |
|------|-----|----------|----------|
| **æ¶æ„** | MCP Server | MCP Server | âŒ **OpenAI Function Calling** |
| **æ–‡ä»¶** | `lib/mcp-tools.ts` | `lib/mcp-tools.ts` | âŒ **`lib/tools.ts`** |
| **å·¥å…·æ•°é‡** | 9ä¸ªå·¥å…· | 9ä¸ªå·¥å…· | âš ï¸ **10ä¸ªå·¥å…·** |
| **ç±»å‹å®‰å…¨** | Zod | Zod | âŒ **è‡ªå®šä¹‰TypeScriptæ¥å£** |

**ä»£ç è¯æ®** (`lib/tools.ts:505-534`):
```typescript
// ==================== OpenAI Function Calling é›†æˆ ====================

/**
 * è½¬æ¢å·¥å…·å®šä¹‰ä¸º OpenAI æ ¼å¼
 */
export function getOpenAITools(): OpenAI.Chat.Completions.ChatCompletionTool[] {
  return AVAILABLE_TOOLS.map(tool => ({
    type: 'function' as const,
    function: {
      name: tool.name,
      description: tool.description,
      parameters: { /* ... */ }
    }
  }));
}
```

**ç»“è®º**: âŒ **æœªä½¿ç”¨MCP Serverï¼Œä»ä½¿ç”¨OpenAI Function Calling**

---

### 2.2 å·¥å…·åˆ—è¡¨è¯¦ç»†å¯¹æ¯”

#### 2.2.1 å¸‚åœºæ•°æ®å·¥å…·

| å·¥å…·åç§° | PRD | æ¶æ„ | ä»£ç  | æ•°æ®æº (PRD) | æ•°æ®æº (ä»£ç ) | ä¸€è‡´æ€§ |
|---------|-----|------|------|------------|-------------|--------|
| `get_stock_price` | âœ… | âœ… | âœ… | Sina Finance | Sina (`lib/market-data.ts`) | âœ… |
| `get_stock_kline` | âœ… | âœ… | âœ… | FMP/Sina | Sina/FMP | âœ… |
| `get_fund_flow` | âœ… | âœ… | âœ… | Sina Finance | Sina | âœ… |
| `get_stock_news` | âœ… | âœ… | âœ… | Sina/Eastmoney | Sina/Eastmoney | âœ… |
| `get_market_overview` | âœ… | âœ… | âœ… | Sina Finance | Sina | âœ… |
| `get_margin_trading` | âœ… | âœ… | âœ… | Sina Finance | Sina | âœ… |
| `get_earnings_calendar` | âœ… | âœ… | âœ… | FMP | FMP | âœ… |
| **`get_stock_announcement`** | âœ… **æ–°å¢** | âœ… **ä¸œæ–¹è´¢å¯ŒAPI** | âŒ **æœªå®ç°** | **Eastmoney API** | **-** | âŒ |
| `calculate_position_value` | âœ… | âœ… | âœ… | æœ¬åœ°è®¡ç®— | æœ¬åœ°è®¡ç®— | âœ… |

**å…³é”®å‘ç°**:
1. âŒ **`get_stock_announcement` æœªå®ç°**: PRDå’Œæ¶æ„æ–‡æ¡£å‡å¼ºè°ƒçš„ä¸œæ–¹è´¢å¯Œå…¬å‘ŠAPIå°šæœªé›†æˆ
2. âœ… **å…¶ä½™8ä¸ªå·¥å…·å·²å®ç°**: ä½†ä½¿ç”¨OpenAI Function Callingè€ŒéMCP Server

---

#### 2.2.2 æŠ•èµ„ç»„åˆç®¡ç†å·¥å…·

| å·¥å…·åç§° | PRD | æ¶æ„ | ä»£ç  | è¯´æ˜ |
|---------|-----|------|------|------|
| `parse_portfolio_command` | âœ… ä¸‰æ­¥è§£ææ¶æ„ | - | âœ… **å·²å®ç°** | ä½¿ç”¨GPT-4o-mini + GPT-4o |
| `manage_portfolio` | âœ… å®Œæ•´é—­ç¯ | - | âœ… **å·²å®ç°** | è°ƒç”¨parse + apply |

**å®ç°è¯¦æƒ…** (`app/api/portfolio/parse-command/route.ts`):
```typescript
// æ­¥éª¤1: æ„å›¾åˆ†ç±» (GPT-4o-mini) - ç¬¬78-131è¡Œ
// æ­¥éª¤2: ç²¾ç¡®è§£æ (GPT-4o) - ç¬¬137-320è¡Œ
// æ­¥éª¤3: éªŒè¯å¢å¼º - ç¬¬367-416è¡Œ
```

**ç»“è®º**: âœ… **æŠ•èµ„ç»„åˆå·¥å…·å·²å®ç°ï¼Œä½†ä½¿ç”¨OpenAIè€ŒéClaude**

---

### 2.3 æ•°æ®æºé›†æˆå¯¹æ¯”

| æ•°æ®æº | PRDè¦æ±‚ | æ¶æ„æ–‡æ¡£ | ä»£ç å®ç° | çŠ¶æ€ |
|--------|---------|----------|----------|------|
| **ä¸œæ–¹è´¢å¯ŒAPI** (Eastmoney) | âœ… å…¬å‘Šã€æ–°é—»ã€è´¢æŠ¥ | âœ… å¼ºè°ƒæ–°å¢ | âŒ **æœªé›†æˆ** | âŒ ç¼ºå¤± |
| **æ–°æµªè´¢ç»API** (Sina Finance) | âœ… å®æ—¶è¡Œæƒ…ã€èµ„é‡‘æµå‘ | âœ… å·²åœ¨ç”¨ | âœ… **å·²å®ç°** | âœ… ä¸€è‡´ |
| **FMP API** | âœ… ç¾è‚¡/æ¸¯è‚¡æ•°æ® | âœ… ä¿ç•™ | âœ… **å·²å®ç°** | âœ… ä¸€è‡´ |

**ä»£ç è¯æ®** (`lib/tools.ts:7-15`):
```typescript
import {
  getStockRealtime,    // Sina Finance
  getIndexRealtime,    // Sina Finance
  getStockNews,        // Sina/Eastmoney (ä½†Eastmoneyæœªå®ç°)
  getStockDaily,       // FMP/Sina
  getFundFlow,         // Sina Finance
  getMarginTrading,    // Sina Finance
  getEarningsCalendar  // FMP
} from './market-data';

// æœªè§ getStockAnnouncement (ä¸œæ–¹è´¢å¯Œå…¬å‘ŠAPI)
```

**ç»“è®º**: âŒ **ä¸œæ–¹è´¢å¯ŒAPIå®Œå…¨æœªé›†æˆï¼Œè¿™æ˜¯PRDå’Œæ¶æ„æ–‡æ¡£çš„æ ¸å¿ƒæ–°å¢åŠŸèƒ½**

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šå‘½ä»¤ç³»ç»Ÿå¯¹æ¯”

### 3.1 å‘½ä»¤åˆ—è¡¨

| å‘½ä»¤ | PRDå®šä¹‰ | æ¶æ„æ–‡æ¡£ | ä»£ç å®ç° | è¯´æ˜ |
|------|---------|----------|----------|------|
| `/research <symbol>` | âœ… å¼ºåˆ¶è°ƒç”¨ç ”ç©¶å‘˜Agent | âœ… | âŒ **æ— æ­¤å‘½ä»¤** | Agentç³»ç»Ÿæœªå®ç° |
| `/analyze <symbol>` | âœ… å¼ºåˆ¶è°ƒç”¨åˆ†æå¸ˆAgent | âœ… | âŒ **æ— æ­¤å‘½ä»¤** | Agentç³»ç»Ÿæœªå®ç° |
| `/risk <symbol>` | âœ… å¼ºåˆ¶è°ƒç”¨é£æ§å‘˜Agent | âœ… | âŒ **æ— æ­¤å‘½ä»¤** | Agentç³»ç»Ÿæœªå®ç° |
| `/mentor <name>` | âœ… åˆ‡æ¢å¯¼å¸ˆäººæ ¼ | âœ… | âš ï¸ **å‰ç«¯å®ç°** | é€šè¿‡UIåˆ‡æ¢ï¼Œéå‘½ä»¤ |

**ä»£ç è¯æ®**:
- æœç´¢ `**/*claude*.ts` â†’ æ— åŒ¹é…æ–‡ä»¶
- æœç´¢ `**/*agent*.ts` â†’ ä»…node_modulesä¾èµ–ï¼Œæ— é¡¹ç›®æ–‡ä»¶

**ç»“è®º**: âŒ **æ‰€æœ‰Agentç›¸å…³å‘½ä»¤å‡æœªå®ç°**

---

## ç¬¬å››éƒ¨åˆ†ï¼šæŠ€æœ¯é€‰å‹å¯¹æ¯”

### 4.1 æ ¸å¿ƒæŠ€æœ¯æ ˆ

| æŠ€æœ¯ç»„ä»¶ | PRD (ç¬¬2812-2813è¡Œ) | æ¶æ„æ–‡æ¡£ | ä»£ç å®ç° | çŠ¶æ€ |
|----------|-------------------|----------|----------|------|
| **AIæœåŠ¡** | Claude (Sonnet & Haiku) | Claude Agent SDK | âŒ **OpenAI GPT-4o** | âŒ æœªè¿ç§» |
| **AIæ¶æ„** | Agent SDK + MCP Tools | 5ä¸ªAgent + MCP Server | âŒ **Function Calling** | âŒ æœªè¿ç§» |
| **æ•°æ®åº“** | Supabase PostgreSQL 15 | Supabase | âœ… **Supabase** | âœ… å·²è¿ç§» |
| **å‘é‡æœç´¢** | pgvector | pgvector | âœ… **pgvector** | âœ… å·²å®ç° |
| **å‰ç«¯** | Next.js 15 + React 18 | Next.js 15 | âœ… **Next.js 15** | âœ… ä¸€è‡´ |
| **éƒ¨ç½²** | PWA + Vercel | PWA | âœ… **PWAé…ç½®** | âœ… å·²å®ç° |

**ç¯å¢ƒå˜é‡å¯¹æ¯”**:

| å˜é‡ | PRDè¦æ±‚ | ä»£ç å®é™…ä½¿ç”¨ | çŠ¶æ€ |
|------|---------|-------------|------|
| `ANTHROPIC_API_KEY` | âœ… å¿…éœ€ | âŒ **æœªä½¿ç”¨** | âŒ ç¼ºå¤± |
| `OPENAI_API_KEY` | âŒ åº”ç§»é™¤ | âœ… **åœ¨ç”¨** | âš ï¸ é—ç•™ |
| `NEXT_PUBLIC_SUPABASE_URL` | âœ… å¿…éœ€ | âœ… åœ¨ç”¨ | âœ… ä¸€è‡´ |
| `FMP_API_KEY` | âœ… å¿…éœ€ | âœ… åœ¨ç”¨ | âœ… ä¸€è‡´ |

---

## ç¬¬äº”éƒ¨åˆ†ï¼šæ–‡ä»¶ç»“æ„å¯¹æ¯”

### 5.1 æ ¸å¿ƒAIæ–‡ä»¶

| æ–‡ä»¶ | PRDæåŠ | æ¶æ„æ–‡æ¡£ | ä»£ç å®ç° | çŠ¶æ€ |
|------|---------|----------|----------|------|
| **`lib/claude-agents.ts`** | âœ… ç¬¬2769è¡Œ | âœ… ç¬¬457è¡Œ | âŒ **ä¸å­˜åœ¨** | âŒ æœªåˆ›å»º |
| **`lib/mcp-tools.ts`** | âœ… ç¬¬2770è¡Œ | âœ… ç¬¬459è¡Œ | âŒ **ä¸å­˜åœ¨** | âŒ æœªåˆ›å»º |
| **`app/api/chat-claude/route.ts`** | âœ… ç¬¬2803è¡Œ | âœ… ç¬¬461è¡Œ | âŒ **ä¸å­˜åœ¨** | âŒ æœªåˆ›å»º |
| `app/api/chat/route.ts` | âš ï¸ åº”åºŸå¼ƒ | âš ï¸ åº”åºŸå¼ƒ | âœ… **åœ¨ç”¨** (OpenAI) | âš ï¸ é—ç•™ |
| `lib/tools.ts` | âš ï¸ åº”åºŸå¼ƒ | âš ï¸ åº”åºŸå¼ƒ | âœ… **åœ¨ç”¨** (688è¡Œ) | âš ï¸ é—ç•™ |

### 5.2 æµ‹è¯•å’Œæ–‡æ¡£æ–‡ä»¶

| æ–‡ä»¶ | PRDæåŠ | æ¶æ„æ–‡æ¡£ | ä»£ç å®ç° | çŠ¶æ€ |
|------|---------|----------|----------|------|
| `app/test-claude/page.tsx` | âŒ æœªæåŠ | âœ… ç¬¬463è¡Œ | âŒ **ä¸å­˜åœ¨** | âš ï¸ ç¼ºå¤± |
| `docs/CLAUDE_AGENT_GUIDE.md` | âŒ æœªæåŠ | âœ… ç¬¬465è¡Œ | âŒ **ä¸å­˜åœ¨** | âš ï¸ ç¼ºå¤± |

---

## ç¬¬å…­éƒ¨åˆ†ï¼šæŠ•èµ„ç»„åˆå‘½ä»¤è§£æå¯¹æ¯”

### 6.1 PRDæè¿° (ç¬¬2366-2371è¡Œ)

```markdown
| **parse_portfolio_command** | è§£æç”¨æˆ·æŒ‡ä»¤ | ä¸‰æ­¥è§£ææ¶æ„ | 85%+å‡†ç¡®ç‡ |
| **manage_portfolio** | æ‰§è¡Œç»„åˆæ“ä½œ | è°ƒç”¨parse + apply | å®Œæ•´é—­ç¯ |
```

### 6.2 å®é™…å®ç°

**æ–‡ä»¶**: `app/api/portfolio/parse-command/route.ts` (629è¡Œ)

**ä¸‰æ­¥è§£ææ¶æ„** (ä¸PRDä¸€è‡´):
```typescript
// æ­¥éª¤1: æ„å›¾åˆ†ç±» (GPT-4o-mini) - classifyIntent()
// æ­¥éª¤2: ç²¾ç¡®è§£æ (GPT-4o) - parseWithIntent()
// æ­¥éª¤3: éªŒè¯å¢å¼º - validateAndEnhance()
```

**å…³é”®å·®å¼‚**:
- PRDæœªæ˜ç¡®è¯´æ˜ä½¿ç”¨OpenAIè¿˜æ˜¯Claude
- å®é™…ä»£ç ä½¿ç”¨**OpenAI GPT-4o + GPT-4o-mini**
- å¦‚æœè¿ç§»åˆ°Claude Agent SDKï¼Œæ­¤éƒ¨åˆ†ä¹Ÿéœ€æ›´æ–°ä¸º**Claude Sonnet**

**ç»“è®º**: âœ… **åŠŸèƒ½å·²å®ç°ï¼Œä½†AIæœåŠ¡æä¾›å•†ä¸ä¸€è‡´** (OpenAI vs Claude)

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šå…³é”®å·®å¼‚æ€»ç»“

### 7.1 æ ¸å¿ƒåŠŸèƒ½æœªå®ç°

| åºå· | åŠŸèƒ½ | PRD | æ¶æ„ | ä»£ç  | ä¼˜å…ˆçº§ |
|------|------|-----|------|------|--------|
| 1 | **Claude Agent SDKé›†æˆ** | âœ… | âœ… | âŒ | **P0 (æœ€é«˜)** |
| 2 | **5ä¸ªä¸“ä¸šAgentç³»ç»Ÿ** | âœ… | âœ… | âŒ | **P0** |
| 3 | **MCP Serverå·¥å…·æ¶æ„** | âœ… | âœ… | âŒ | **P0** |
| 4 | **ä¸œæ–¹è´¢å¯Œå…¬å‘ŠAPI** | âœ… | âœ… | âŒ | **P1** |
| 5 | **å‘½ä»¤ç³»ç»Ÿ** (/research, /analyzeç­‰) | âœ… | âœ… | âŒ | **P1** |
| 6 | **æµ‹è¯•é¡µé¢** `/test-claude` | âŒ | âœ… | âŒ | P2 |
| 7 | **Agentä½¿ç”¨æŒ‡å—** | âŒ | âœ… | âŒ | P3 |

### 7.2 ç°æœ‰å®ç°ä¸æ–‡æ¡£ä¸ç¬¦

| åºå· | é¡¹ç›® | æ–‡æ¡£æè¿° | ä»£ç å®é™… | å½±å“ |
|------|------|----------|----------|------|
| 1 | AIæœåŠ¡ | Claude | **OpenAI** | é«˜ |
| 2 | Agentæ¶æ„ | 5ä¸ªAgentåä½œ | **å•ä¸€GPT-4o** | é«˜ |
| 3 | å·¥å…·è°ƒç”¨ | MCP Server | **Function Calling** | ä¸­ |
| 4 | å¯¼å¸ˆåˆ‡æ¢ | Agentåˆ‡æ¢ | **Promptåˆ‡æ¢** | ä¸­ |
| 5 | æ•°æ®æº | ä¸œæ–¹è´¢å¯Œ+æ–°æµª+FMP | **ä»…æ–°æµª+FMP** | ä¸­ |
| 6 | ç¯å¢ƒå˜é‡ | ANTHROPIC_API_KEY | **OPENAI_API_KEY** | ä¸­ |

---

## ç¬¬å…«éƒ¨åˆ†ï¼šè¿ç§»è·¯çº¿å›¾

### 8.1 Phase 1: Claude Agent SDKåŸºç¡€è¿ç§» (P0)

**ç›®æ ‡**: æ›¿æ¢OpenAIä¸ºClaude Agent SDK

#### æ­¥éª¤1: åˆ›å»ºæ ¸å¿ƒAgentæ–‡ä»¶
- [ ] åˆ›å»º `lib/claude-agents.ts`
  - Coordinator Agentå®šä¹‰
  - Researcher Agentå®šä¹‰
  - Analyst Agentå®šä¹‰
  - Risk Manager Agentå®šä¹‰
  - Mentor Agentå®šä¹‰ (åŒ…å«7ä½å¯¼å¸ˆäººæ ¼)
- [ ] åˆ›å»º `lib/mcp-tools.ts`
  - MCP Serveré…ç½®
  - 9ä¸ªå·¥å…·å®šä¹‰ (Zod schema)
  - å·¥å…·handlerå®ç°

#### æ­¥éª¤2: åˆ›å»ºClaude APIå…¥å£
- [ ] åˆ›å»º `app/api/chat-claude/route.ts`
  - Coordinator Agentè°ƒåº¦é€»è¾‘
  - æ„å›¾åˆ†ç±»
  - Agentä¸²è¡Œ/å¹¶è¡Œè°ƒç”¨
  - ç»“æœèšåˆ

#### æ­¥éª¤3: ç¯å¢ƒå˜é‡æ›´æ–°
- [ ] æ·»åŠ  `ANTHROPIC_API_KEY` åˆ° `.env.local`
- [ ] æ›´æ–°CLAUDE.mdä¸­çš„ç¯å¢ƒå˜é‡è¯´æ˜
- [ ] ä¿ç•™ `OPENAI_API_KEY` (ç”¨äºRAG embeddings)

---

### 8.2 Phase 2: ä¸œæ–¹è´¢å¯ŒAPIé›†æˆ (P1)

**ç›®æ ‡**: å®ç°`get_stock_announcement`å·¥å…·

#### æ­¥éª¤1: æ•°æ®æºé›†æˆ
- [ ] ç ”ç©¶ä¸œæ–¹è´¢å¯Œå…¬å‘ŠAPI
  - APIæ–‡æ¡£è°ƒç ”
  - æ¥å£æµ‹è¯•
  - æ•°æ®æ ¼å¼ç¡®è®¤
- [ ] åˆ›å»º `lib/eastmoney-api.ts`
  - `getStockAnnouncement()` å‡½æ•°
  - å…¬å‘Šç±»å‹ç­›é€‰
  - é”™è¯¯å¤„ç†

#### æ­¥éª¤2: MCPå·¥å…·æ·»åŠ 
- [ ] åœ¨ `lib/mcp-tools.ts` æ·»åŠ  `get_stock_announcement`
  - Zod schemaå®šä¹‰
  - è°ƒç”¨eastmoney-api
  - è¿”å›æ ¼å¼åŒ–æ•°æ®

---

### 8.3 Phase 3: å‘½ä»¤ç³»ç»Ÿå®ç° (P1)

**ç›®æ ‡**: æ”¯æŒ `/research`, `/analyze`, `/risk`, `/mentor` å‘½ä»¤

#### æ­¥éª¤1: å‘½ä»¤è§£æ
- [ ] åœ¨ `app/api/chat-claude/route.ts` æ·»åŠ å‘½ä»¤æ£€æµ‹
  - æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
  - æå–å‘½ä»¤å‚æ•°
  - è·¯ç”±åˆ°å¯¹åº”Agent

#### æ­¥éª¤2: å‰ç«¯é›†æˆ
- [ ] æ›´æ–°èŠå¤©ç•Œé¢æ”¯æŒå‘½ä»¤è¾“å…¥
- [ ] æ·»åŠ å‘½ä»¤è‡ªåŠ¨è¡¥å…¨
- [ ] æ˜¾ç¤ºAgentè°ƒç”¨çŠ¶æ€

---

### 8.4 Phase 4: æµ‹è¯•å’Œæ–‡æ¡£ (P2-P3)

#### æ­¥éª¤1: æµ‹è¯•é¡µé¢
- [ ] åˆ›å»º `app/test-claude/page.tsx`
  - Agentå•ç‹¬æµ‹è¯•
  - å‘½ä»¤æµ‹è¯•
  - å·¥å…·è°ƒç”¨æµ‹è¯•
  - æ€§èƒ½ç›‘æ§

#### æ­¥éª¤2: æ–‡æ¡£å®Œå–„
- [ ] åˆ›å»º `docs/CLAUDE_AGENT_GUIDE.md`
  - Agentæ¶æ„è¯´æ˜
  - ä½¿ç”¨æŒ‡å—
  - æœ€ä½³å®è·µ
  - æ•…éšœæ’æŸ¥

---

## ç¬¬ä¹éƒ¨åˆ†ï¼šé£é™©è¯„ä¼°

### 9.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| Claude APIé™æµ | é«˜ | ä¸­ | å®ç°è¯·æ±‚é˜Ÿåˆ—ã€fallbackåˆ°OpenAI |
| Agentåä½œå»¶è¿Ÿ | ä¸­ | é«˜ | ä¼˜åŒ–ä¸²è¡Œè°ƒåº¦ã€å®ç°å¹¶è¡Œè°ƒç”¨ |
| MCPå·¥å…·å…¼å®¹æ€§ | ä¸­ | ä½ | å‚è€ƒClaudeå®˜æ–¹ç¤ºä¾‹ã€å……åˆ†æµ‹è¯• |
| ä¸œæ–¹è´¢å¯ŒAPIç¨³å®šæ€§ | ä¸­ | ä¸­ | å®ç°ç¼“å­˜ã€æ·»åŠ é‡è¯•æœºåˆ¶ |

### 9.2 è¿ç§»é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| ç”¨æˆ·ä½“éªŒé™çº§ | é«˜ | ä¸­ | ç°åº¦å‘å¸ƒã€ä¿ç•™OpenAI fallback |
| æˆæœ¬è¶…é¢„ç®— | ä¸­ | ä½ | ç›‘æ§APIä½¿ç”¨ã€ä¼˜åŒ–Haikuè°ƒç”¨æ¯”ä¾‹ |
| åŠŸèƒ½å›å½’ | é«˜ | ä¸­ | E2Eæµ‹è¯•è¦†ç›–ã€ç”¨æˆ·éªŒæ”¶æµ‹è¯• |

---

## ç¬¬åéƒ¨åˆ†ï¼šå»ºè®®è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œ (æœ¬å‘¨)

1. âœ… **ç¡®è®¤è¿ç§»æ–¹å‘**: ä¸äº§å“å›¢é˜Ÿç¡®è®¤æ˜¯å¦ç»§ç»­æ¨è¿›Claude Agent SDKè¿ç§»
2. â³ **è®¾ç½®å¼€å‘ç¯å¢ƒ**: ç”³è¯·Claude API Keyï¼Œé…ç½®æœ¬åœ°æµ‹è¯•ç¯å¢ƒ
3. â³ **åˆ›å»ºåŸºç¡€æ¡†æ¶**:
   - åˆ›å»º `lib/claude-agents.ts` éª¨æ¶
   - åˆ›å»º `lib/mcp-tools.ts` éª¨æ¶
   - åˆ›å»º `app/api/chat-claude/route.ts` éª¨æ¶

### çŸ­æœŸç›®æ ‡ (2å‘¨å†…)

1. â³ **å®ç°Coordinator Agent**: åŸºç¡€æ„å›¾åˆ†ç±»å’Œä»»åŠ¡åˆ†å‘
2. â³ **è¿ç§»2-3ä¸ªæ ¸å¿ƒå·¥å…·**: å…ˆè¿ç§» `get_stock_price`, `get_stock_kline` åˆ°MCP
3. â³ **ç«¯åˆ°ç«¯æµ‹è¯•**: éªŒè¯åŸºæœ¬å¯¹è¯æµç¨‹

### ä¸­æœŸç›®æ ‡ (4å‘¨å†…)

1. â³ **å®Œæˆ5ä¸ªAgent**: å…¨éƒ¨Agentå®ç°å¹¶æµ‹è¯•
2. â³ **ä¸œæ–¹è´¢å¯ŒAPI**: é›†æˆå…¬å‘ŠæŸ¥è¯¢åŠŸèƒ½
3. â³ **å‘½ä»¤ç³»ç»Ÿ**: å®ç°4æ¡æ ¸å¿ƒå‘½ä»¤
4. â³ **æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ–Agentè°ƒåº¦å»¶è¿Ÿ

### é•¿æœŸç›®æ ‡ (6-8å‘¨)

1. â³ **å…¨é¢æµ‹è¯•**: E2Eæµ‹è¯•ã€å‹åŠ›æµ‹è¯•ã€ç”¨æˆ·éªŒæ”¶æµ‹è¯•
2. â³ **æ–‡æ¡£å®Œå–„**: Agentä½¿ç”¨æŒ‡å—ã€å¼€å‘æ–‡æ¡£
3. â³ **ç°åº¦å‘å¸ƒ**: 10% â†’ 50% â†’ 100% æµé‡åˆ‡æ¢
4. â³ **OpenAIä¸‹çº¿**: ç§»é™¤é—ç•™ä»£ç ï¼Œæ¸…ç†ä¾èµ–

---

## é™„å½•A: ä»£ç æ–‡ä»¶å¯¹æ¯”è¡¨

### ç°æœ‰æ–‡ä»¶ (OpenAIæ¶æ„)

| æ–‡ä»¶ | è¡Œæ•° | ç”¨é€” | è¿ç§»åçŠ¶æ€ |
|------|------|------|----------|
| `app/api/chat/route.ts` | ~200 | OpenAI GPT-4oå¯¹è¯å…¥å£ | âš ï¸ åºŸå¼ƒæˆ–ä½œä¸ºfallback |
| `lib/tools.ts` | 688 | OpenAI Function Callingå·¥å…· | âš ï¸ åºŸå¼ƒæˆ–é‡æ„ä¸ºMCP |
| `lib/market-data.ts` | - | å¸‚åœºæ•°æ®è·å– (Sina/FMP) | âœ… ä¿ç•™ï¼Œæ·»åŠ Eastmoney |
| `lib/rag.ts` | - | RAGçŸ¥è¯†æ£€ç´¢ | âœ… ä¿ç•™ (ä»å¯ç”¨OpenAI embeddings) |
| `lib/memory.ts` | - | ç”¨æˆ·é•¿æœŸè®°å¿† | âœ… ä¿ç•™ |
| `app/api/portfolio/parse-command/route.ts` | 629 | ç»„åˆå‘½ä»¤è§£æ (GPT-4o) | âš ï¸ æ”¹ç”¨Claude Sonnet |

### å¾…åˆ›å»ºæ–‡ä»¶ (Claude Agent SDKæ¶æ„)

| æ–‡ä»¶ | é¢„ä¼°è¡Œæ•° | ç”¨é€” |
|------|----------|------|
| `lib/claude-agents.ts` | 300-400 | 5ä¸ªAgentå®šä¹‰ |
| `lib/mcp-tools.ts` | 400-500 | MCP Server + 9å·¥å…· |
| `app/api/chat-claude/route.ts` | 200-300 | Claude Agentä¸»å…¥å£ |
| `lib/eastmoney-api.ts` | 150-200 | ä¸œæ–¹è´¢å¯ŒAPIé›†æˆ |
| `app/test-claude/page.tsx` | 200-300 | æµ‹è¯•ç•Œé¢ |
| `docs/CLAUDE_AGENT_GUIDE.md` | - | ä½¿ç”¨æŒ‡å— |

---

## é™„å½•B: å·¥å…·å®šä¹‰å¯¹æ¯” (è¯¦ç»†)

### B.1 get_stock_announcement (æ ¸å¿ƒç¼ºå¤±)

**PRDå®šä¹‰** (ç¬¬2363è¡Œ):
```markdown
| **get_stock_announcement** | å…¬å‘ŠæŸ¥è¯¢ | Eastmoney API |
```

**æ¶æ„æ–‡æ¡£** (ç¬¬305è¡Œ):
```
ä¸œæ–¹è´¢å¯Œï¼šå…¬å‘Šã€æ–°é—»ã€è´¢æŠ¥
```

**ä»£ç å®ç°**: âŒ **å®Œå…¨æœªå®ç°**

**å»ºè®®å®ç°** (ä¼ªä»£ç ):
```typescript
// lib/mcp-tools.ts
{
  name: 'get_stock_announcement',
  description: 'è·å–Aè‚¡ä¸Šå¸‚å…¬å¸å…¬å‘Šï¼ˆä¸œæ–¹è´¢å¯Œæ•°æ®æºï¼‰',
  inputSchema: z.object({
    symbol: z.string().describe('è‚¡ç¥¨ä»£ç ï¼Œå¦‚600519'),
    type: z.enum(['all', 'annual', 'quarter', 'event']).describe('å…¬å‘Šç±»å‹'),
    limit: z.number().default(10)
  }),
  handler: async ({ symbol, type, limit }) => {
    const announcements = await getStockAnnouncement(symbol, type, limit);
    return { symbol, count: announcements.length, announcements };
  }
}
```

---

## æ€»ç»“

**æ ¸å¿ƒå‘ç°**: PRDå’Œæ¶æ„æ–‡æ¡£è¯¦ç»†æè¿°çš„Claude Agent SDKå¤šAgentåä½œç³»ç»Ÿ**å°šæœªåœ¨ä»£ç ä¸­å®ç°**ã€‚å½“å‰ä»£ç ä»ä½¿ç”¨OpenAI GPT-4o + Function Callingæ¶æ„ã€‚

**æœ€å¤§å·®è·**:
1. âŒ **Claude Agent SDKå®Œå…¨ç¼ºå¤±** (5ä¸ªAgentç³»ç»Ÿ)
2. âŒ **MCP Serveræœªå®ç°** (ä»ç”¨OpenAI Function Calling)
3. âŒ **ä¸œæ–¹è´¢å¯ŒAPIæœªé›†æˆ** (æ ¸å¿ƒæ–°å¢æ•°æ®æº)
4. âŒ **å‘½ä»¤ç³»ç»Ÿæœªå®ç°** (/research, /analyzeç­‰)

**å»ºè®®**:
- å¦‚ç»§ç»­æ¨è¿›Claudeè¿ç§»ï¼Œéœ€æŠ•å…¥4-8å‘¨å¼€å‘æ—¶é—´
- å¦‚ä¿ç•™OpenAIï¼Œéœ€åŒæ­¥æ›´æ–°PRDå’Œæ¶æ„æ–‡æ¡£
- å»ºè®®é‡‡ç”¨ç°åº¦å‘å¸ƒç­–ç•¥ï¼Œé™ä½è¿ç§»é£é™©

---

**æŠ¥å‘Šå®Œæˆæ—¶é—´**: 2026-01-19
**ä¸‹æ¬¡æ£€æŸ¥å»ºè®®**: å®ŒæˆClaude Agent SDK Phase 1åè¿›è¡Œä»£ç éªŒè¯
